function createTagsBox(e,a,t){var r;switch(e.type){case"line":r=bulidLineChart(createChart(e,t),a);break;case"bar":r=bulidBarChart(createChart(e,t),a);break;case"pie":r=bulidPieChart(createChart(e,t),a);break;case"radar":r=bulidRadarChart(createChart(e,t),a);break;case"tree":r=bulidTreeChart(createChart(e,t),a);break;case"treemap":r=bulidTreemapChart(createChart(e,t),a);break;case"sunburst":r=bulidSunburstChart(createChart(e,t),a);break;case"funnel":r=bulidFunnelChart(createChart(e,t),a);break;case"gauge":r=bulidGaugeChart(createChart(e,t),a);break;case"boxplot":r=bulidBoxplotChart(createChart(e,t),a);break;case"heatmap":r=bulidHeatmapChart(createChart(e,t),a);break;case"graph":r=bulidGraphChart(createChart(e,t),a);break;case"parallel":r=bulidParallelChart(createChart(e,t),a);break;case"sankey":r=bulidsankeyChart(createChart(e,t),a);break;case"scatter":r=bulidScatterChart(createChart(e,t),a);break;case"map":r=bulidMapChart(createChart(e,t),a);break;case"candlestick":r=bulidCandkestickChart(createChart(e,t),a);break;case"text":r=bulidText(e,a);break;case"rect":r=bulidRect(e,a);break;case"circle":r=bulidCircle(e,a);break;case"image":r=bulidImage(e,a);break;case"table":r=bulidTable(e,a);break;case"time":r=bulidTime(e,a);break;case"triangle":r=bulidTriangle(e,a);break;case"iframe":r=bulidIframe(e,a);break;case"swiper":r=bulidSwiper(e,a)}return r}function setRectP(e,a){var t=a.rectP;e.css({left:t.x,top:t.y,width:t.width+"px",height:t.height+"px",zIndex:t.zIndex,transform:"rotate("+t.rotate+"deg)"})}function setTagsParts(r,e,s){currBox=r,e&&$.each(e,function(e,a){switch(e){case"fontSize":r.find(".tag-"+s.type).css("font-size",a+"px");break;case"fontWeight":r.find(".tag-"+s.type).css("font-weight",a);break;case"textShadow":r.find(".tag-"+s.type).css("text-shadow",a);break;case"color":r.find(".tag-"+s.type).css("color",a);break;case"backgroundImage":var t=a;t=t.replace(/\\/g,"/"),r.find(".tag-"+s.type).css({"background-image":"url('"+t+"')","background-repeat":"no-repeat","background-size":"100% 100%"});break;case"backgroundColor":r.find(".tag-"+s.type).css({"background-color":a});break;case"text":r.find(".tag-"+s.type).html(a);break;case"borderRadius":r.find(".tag-"+s.type).css({"border-radius":a+"px"});break;case"iframeUrl":case"imgUrl":r.find(".tag-"+s.type).attr("src",a);break;case"fontFamily":r.find(".tag-"+s.type).css("font-family",a);break;case"borderWidth":r.find(".tag-"+s.type).css("border-width",a);break;case"borderStyle":r.find(".tag-"+s.type).css("border-style",a);break;case"borderColor":r.find(".tag-"+s.type).css("border-color",a);break;case"textAlign":r.find(".tag-"+s.type).css("text-align",a);break;case"lineHeight":r.find(".tag-"+s.type).css("line-height",a+"px")}})}function bulidText(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><div class="tag-text" style="width: 100%;height: 100%;"></div></div>'),r=e.parts;if(setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),a){var s=getJsonValue(a,e.data.dimension[0].keyname);e.parts&&e.parts.format?e.parts.text=e.parts.format.replace(/{val}/g,s):e.parts.text=s}return setTagsParts(t,r,e),t}function bulidRect(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><div class="tag-rect" style="width:100%;height:100%;background-color:#ffffff;"></div></div>'),r=e.parts;return setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),setTagsParts(t,r,e),t}function bulidImage(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><img class="tag-image" width="100%" height="100%" src="static/img/default.jpg" /></div>'),r=e.parts;return setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),setTagsParts(t,r,e),t}function bulidIframe(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><iframe class="tag-iframe" style="width:100%;height:100%;"></iframe></div>'),r=e.parts;return setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),setTagsParts(t,r,e),t}function bulidSwiper(e,a){var r=$('<div class="box" style="width: 480px;height: 320px;"><div class="tag-swiper swiper-container"><div class="swiper-wrapper"></div><div class="swiper-pagination"></div></div></div>'),t=e.parts;setRectP(r,e),r.appendTo("#content"),r.data("prop",e),r.initBox({tagType:e.type}),setTagsParts(r,t,e),0<e.slides.length&&$.each(e.slides,function(e,a){var t=$('<div class="swiper-slide"></div>');a.id||(a.id=guid()),t.attr("id","slide-"+a.id),t.appendTo(r.find(".swiper-wrapper")),createTagsBox(a,!1,t)});var s=new Swiper(r.find(".tag-swiper"),e.swiper);return r.data("prop").mySwiper=s,r}function bulidCircle(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><div class="tag-circle" style="width:100%;height:100%;border-radius: 100%;background-color:#ffffff"></div></div>'),r=e.parts;return setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),setTagsParts(t,r,e),t}function bulidTable(e,a){var t=$('<div class="box" style="width: 480px;height: 320px;"><div class="tag-table kgo-scroll-sty " style="width:100%;height:100%;"><div class="kgo-scroll-head"></div><div class="kgo-scroll-body"><ul class="kgo-scroll-body-ul"></ul></div></div></div>'),r=e.parts;setRectP(t,e),delete e.id,t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type});var s=t.find(".tag-"+e.type);if(a){var i=e.data,n=getJsonValue(a,i.dimension[0].keyname),d={ajax_data:getJsonValue(a,i.series[0].keyname),ajax_type:"POST",supportCheckbox:!1,supportAutoOrder:!1,height:"100%",width:"100%",columnData:n};s.initScroll(d),t.data("prop").gmOptions=d}else s.initScroll(e.gmOptions);return e.effect&&e.effect.autoscroll&&s.autoScroll(),setTagsParts(t,r,e),t}function bulidTime(e,a){var t=$('<div class="box" style="width: 100px;height: 40px;"><div class="clock tag-time"></div></div>'),r=e.parts;return setRectP(t,e),t.appendTo("#content"),t.data("prop",e),t.initBox({tagType:e.type}),t.find(".tag-"+e.type).ledTime(),setTagsParts(t,r,e),t}function createChart(prop,oelem){prop.myChart&&prop.myChart.dispose(),"string"==typeof prop.options&&(prop.options=eval("("+prop.options+")")),prop.optionsText&&"string"==typeof prop.optionsText&&(prop.options=eval("("+prop.optionsText+")"));var html=$('<div class="box" style="height:100%;width:100%;"><div class="tag-charts" style="height:100%;width:100%"></div></div>');return html.data("prop",prop),prop.slide?(html.appendTo(oelem),html.find(".tag-charts").bind("click",function(){$(".box").removeClass("box-selected"),html.addClass("box-selected"),$("#rightnav").addClass("on"),getProp($(this).parent(),!0)})):(html.appendTo("#content"),setRectP(html,prop),html.initBox({tagType:prop.type})),html}function bulidChartOther(e){var a=e.data("prop"),t=a.other,r=a.options||{};t.axis?(r.xAxis=t.sYAxis,r.yAxis=t.sXAxis):(r.xAxis=t.sXAxis,r.yAxis=t.sYAxis),setChartTheme(e,a)}function bulidLineChart(e,r){var s=e.data("prop"),i=s.subtype,a=s.data,t=s.other,n=s.options||{};if(r){n.legend=n.legend||{},n.legend.data=n.legend.data||[],n.series=n.series||[];var d=getJsonValue(r,a.dimension[0].keyname);$.each(a.series,function(e,a){var t={data:getJsonValue(r,a.keyname),type:s.type,name:a.displayname};2==i?t.areaStyle={}:3==i&&(t.areaStyle={},t.stack="堆叠标识"),n.series[e]?n.series[e]=$.extend({},n.series[e],t):n.series.push(t),n.legend.data[e]?n.legend.data[e]=a.displayname:n.legend.data.push(a.displayname)}),n.series=n.series.slice(0,a.series.length),n.legend.data=n.legend.data.slice(0,a.series.length),n.xAxis.data=d,t.sXAxis=n.xAxis,t.sYAxis=n.yAxis}return setChartTheme(e,s),e}function bulidBarChart(e,r){var s=e.data("prop"),a=s.data,i=s.options||{},t=s.other||{};if(r){i.legend=i.legend||{},i.legend.data=i.legend.data||[],i.series=i.series||[];var n=getJsonValue(r,a.dimension[0].keyname);$.each(a.series,function(e,a){var t={data:getJsonValue(r,a.keyname),type:s.type,name:a.displayname};i.series[e]?i.series[e]=$.extend({},i.series[e],t):i.series.push(t),i.legend.data[e]?i.legend.data[e]=a.displayname:i.legend.data.push(a.displayname)}),i.series=i.series.slice(0,a.series.length),i.legend.data=i.legend.data.slice(0,a.series.length),t.axis?i.yAxis.data=n:i.xAxis.data=n,t.sXAxis=i.xAxis,t.sYAxis=i.yAxis}return setChartTheme(e,s),e}function bulidPieChart(e,a){var t=e.data("prop"),r=t.data,s=t.options||{};if(a){s.legend=s.legend||{},s.legend.data=s.legend.data||[],s.series=s.series||[];for(var i=getJsonValue(a,r.dimension[0].keyname),n=getJsonValue(a,r.series[0].keyname),d=[],o=0;o<i.length;o++){var p={name:i[o],value:n[o]};s.legend.data[o]?s.legend.data[o]=i[o]:s.legend.data.push(i[o]),d.push(p)}s.legend.data=s.legend.data.slice(0,i.length);var l={data:d,type:t.type};s.series[0]?s.series[0]=$.extend({},s.series[0],l):s.series.push(l)}return setChartTheme(e,t),e}function bulidRadarChart(e,a){var s=e.data("prop"),t=s.data,i=s.options||{};if(a){i.legend=i.legend||{},i.legend.data=i.legend.data||[];var n=getJsonValue(a,t.dimension[0].keyname),r=getJsonValue(a,t.series[0].keyname);i.series=i.series||[],i.radar=i.radar||{},i.radar.indicator=i.radar.indicator||[];var d={},o=0;$.each(r,function(e,a){var t={data:[],type:s.type},r={name:n[e],value:[]};i.legend.data[e]?i.legend.data[e]=n[e]:i.legend.data.push(n[e]),$.each(a,function(e,a){d[a.indicator]=a.value,o=o>a.value?o:a.value,r.value.push(a.value)}),t.data.push(r),i.series[e]?i.series[e]=$.extend({},i.series[e],t):i.series.push(t)}),i.series=i.series.slice(0,r.length),i.legend.data=i.legend.data.slice(0,n.length);var p=0;$.each(d,function(e,a){i.radar.indicator[p]?i.radar.indicator[p]=$.extend({},i.radar.indicator[p],{name:e,max:o}):i.radar.indicator.push({name:e,max:o}),p++}),i.radar.indicator=i.radar.indicator.slice(0,p)}return setChartTheme(e,s),e}function bulidTreeChart(e,a){var t=e.data("prop"),r=t.data,s=t.options||{};if(a){var i=getJsonValue(a,r.series[0].keyname);s.series=[];var n={data:[i],type:t.type};s.series.push(n)}return setChartTheme(e,t),e}function bulidTreemapChart(e,a){var t=e.data("prop"),r=t.data,s=t.options||{};if(a){var i=getJsonValue(a,r.series[0].keyname);s.series=[];var n={data:i,type:t.type};s.series.push(n)}return setChartTheme(e,t),e}function bulidSunburstChart(e,a){var t=e.data("prop"),r=t.data,s=t.options||{};if(a){var i=getJsonValue(a,r.series[0].keyname);s.series=[];var n={data:i,type:t.type};s.series.push(n)}return setChartTheme(e,t),e}function bulidFunnelChart(e,a){var r=e.data("prop"),t=r.data,s=r.options||{};if(a){var i=getJsonValue(a,t.series[0].keyname);s.series=[],$.each(i,function(e,a){var t=a;t.type=r.type,s.series.push(t)})}return setChartTheme(e,r),e}function bulidGaugeChart(e,a){var r=e.data("prop"),t=r.data,s=r.options||{},i=r.other;if(a){var n=getJsonValue(a,t.series[0].keyname);s.series=s.series||[],$.each(n,function(e,a){var t={};(t=4==i.dataFrom?{data:[{value:a}]}:a).type=r.type,s.series[e]?s.series[e]=$.extend({},s.series[e],t):s.series.push(t)}),s.series=s.series.slice(0,n.length)}return setChartTheme(e,r),e}function bulidMapChart(r,s){var i=r.data("prop").other.mappath;return-1<i.indexOf("geographic")&&(i=i.substring(i.indexOf("geographic")+"geographic".length,i.length)),getAjaxMapDataSync({mappath:i},function(e){if(0==e.code){data=e.res;var a=hex_md5(data),t=data;echarts.registerMap(a,t),bulidMapData(r,a,i,s)}}),r}function bulidMapData(e,a,t,i){var r=e.data("prop"),n=$.extend({},r.options);n.geo.map=a;var s=r.data;if(i){n.series=n.series||[],n.legend=n.legend||{},n.legend.data=[];var d=0;$.each(s.dimension,function(e,a){var t=getJsonValue(i,a.keyname),r=a.displayname;-1<$.inArray(a.displayname,n.legend.data)?(n.legend.data.push(a.displayname+d),r+=d):n.legend.data.push(a.displayname);var s={name:r,data:t,type:"scatter",coordinateSystem:"geo"};n.series[d]?n.series[d]=$.extend({},n.series[d],s):n.series.push(s),d++}),$.each(s.series,function(e,a){var t=getJsonValue(i,a.keyname),r=a.displayname;-1<$.inArray(a.displayname,n.legend.data)?(n.legend.data.push(a.displayname+d),r+=d):n.legend.data.push(a.displayname);var s={name:r,data:t,type:"effectScatter",coordinateSystem:"geo"};n.series[d]?n.series[d]=$.extend({},n.series[d],s):n.series.push(s),d++}),n.series=n.series.slice(0,d),n.legend.data=n.legend.data.slice(0,d)}var o=e.find(".tag-charts")[0],p=echarts.init(o);p.setOption(n,!0),r.options=n,r.myChart=p,r.other.mappath=t,r.optionsText=JSON.stringify(n,function(e,a){return"function"==typeof a?"&"+a.toString().replace(/\s+/g," ").replace(/\n/g,"")+"&":a},4),r.optionsText=r.optionsText.replace(/"&/g,"").replace(/&"/g,""),e.data("prop",r),e.initdata(),$(".box").removeClass("box-selected"),currBox=e}function setChartTheme(r,s){var i=s.options,n=s.other;s.data;if(s.myChart&&s.myChart.dispose(),n&&n.theme){var e="../../statics/bddp/static/charts-theme/"+n.theme+".json";getJSONFileData(e,function(e){var a=e;echarts.registerTheme(n.theme,a);var t=echarts.init(r.find(".tag-charts")[0],n.theme);t.setOption(i),s.myChart=t,s.options=i,s.optionsText=JSON.stringify(i,function(e,a){return"function"==typeof a?"&"+a.toString().replace(/\s+/g," ").replace(/\n/g,"")+"&":a},4),s.optionsText=s.optionsText.replace(/"&/g,"").replace(/&"/g,""),r.data("prop",s)})}else{var a=echarts.init(r.find(".tag-charts")[0]);a.setOption(i),s.myChart=a,s.options=i,s.optionsText=JSON.stringify(i,function(e,a){return"function"==typeof a?"&"+a.toString().replace(/\s+/g," ").replace(/\n/g,"")+"&":a},4),s.optionsText=s.optionsText.replace(/"&/g,"").replace(/&"/g,""),r.data("prop",s)}currBox=r}function getJsonValue(e,a){var t=a.split("."),r=e[t[0]];return"[object Array]"===Object.prototype.toString.apply(r)&&1<t.length?getJsonArray(r,0,t):"[object Object]"===Object.prototype.toString.apply(r)&&1<t.length?getJsonObject(r,0,t):r}function getJsonObject(e,a,t){if(a<t.length){var r=e[t[a+1]];return"[object Array]"===Object.prototype.toString.apply(r)&&a+1<t.length-1?getJsonArray(r,a+1,t):"[object Object]"===Object.prototype.toString.apply(r)&&a+1<t.length-1?getJsonObject(r,a+1,t):r}}function getJsonArray(e,r,s){var i=[];return $.each(e,function(e,a){if(r<s.length-1){var t=a[s[r+1]];"[object Array]"===Object.prototype.toString.apply(t)?i.push(getJsonArray(t,r+1,s)):"[object Object]"===Object.prototype.toString.apply(t)?i.push(getJsonObject(t,r+1,s)):i.push(t)}else i.push(a)}),i}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4()}function uniq(e){for(var a=[],t=0;t<e.length;t++)-1==a.indexOf(e[t])&&a.push(e[t]);return a}