$(function(){});var $panel=$(".select_panel"),$showBtn=$panel.find(".show_btn"),panel={parmbar:$(".param_panel"),parmArea:$(".panel_area"),opt:{editor:$(".tb-center"),height:100,minHeight:178,maxHeight:700,speed:300,fa_lock:"fa-lock",fa_unlock:"fa-unlock",keydown:!1,init:!1,cssVal:"",jsVal:""},model:{text:{text:"文字",dbType:"string",parmCName:"文字",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"1",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"3",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"80",widthL:"100",widthR:"0",height:"35",fontSize:"12",verticalAlign:"1"},input:{text:"输入框",dbType:"string",parmCName:"输入框",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},select:{text:"下拉",dbType:"string",parmCName:"下拉",parmName:"param",parmType:"normal",parmvl:"",showType:"select",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},check:{text:"复选",dbType:"string",parmCName:"复选",parmName:"param",parmType:"normal",parmvl:"",showType:"checkbox",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},radio:{text:"单选",dbType:"string",parmCName:"单选",parmName:"param",parmType:"normal",parmvl:"",showType:"radio",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},time:{text:"时间",dbType:"string",parmCName:"时间",parmName:"param",parmType:"normal",parmvl:"",showType:"time",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},render:{text:"区域时间",dbType:"string",parmCName:"区域时间",parmName:"param",parmType:"normal",parmvl:"",showType:"render",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"dateStart",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},searchlist:{text:"查询按钮",dbType:"string",parmCName:"查询按钮",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"3",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"80",widthL:"0",widthR:"100",height:"35",fontSize:"12",verticalAlign:"1",sts:0}},setObjPos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,i=a.position().left,l=a.position().top,p=event.pageX,o=event.pageY,r=a.width(),s=a.height(),d={};d.top=n,d.left=t,d.rtop=l,d.rleft=i,d.width=r,d.height=s,d.x=p,d.y=o,a.data("pos",d)},setObjPosForObj:function(e,a){var t=$(a),n=t.offset().left,i=t.offset().top,l=t.width(),p=t.height(),o={};o.top=i,o.left=n,o.width=l,o.height=p,o.display="block",$(e).css(o)},position:function(){return{top:150,left:$(".tb-foot_left").offset().left}},relativePos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,i=event.pageX,l=event.pageY,p=(a.width(),a.height(),l-n),o=i-t;return panel.setData(a,"left",o),panel.setData(a,"top",p),{top:p,left:o}},innerPos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,i=e.pageX,l=e.pageY;a.width(),a.height();return{left:i-t,top:l-n}},isHover:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,i=a.width(),l=a.height(),p=e.pageX,o=e.pageY;return t<p&&n<o&&o<n+l&&p<+i},getCtrlVal:function(e,a,t){return e<=a?e=a:t<e&&a<t&&(e=t),e},setData:function(e,a,t){$(e).data(a,t)},getData:function(e,a){return $(e).data(a)},stopEvent:function(e){e.preventDefault(),e.stopPropagation()},add:function(e,a,t){return""!=e&&null!=e&&null!=e||(e=0),e=t<=e&&t?t:parseInt(e)+parseInt(a)},sub:function(e,a,t){return""!=e&&null!=e&&null!=e||(e=0),e=e<=t&&t?t:parseInt(e)-parseInt(a)},show:function(e){var a=panel.opt.editor;a.stop();var t=panel.opt.height;t=a.data("top")?a.data("top"):parseInt(t)+214,a.animate({top:t},panel.opt.speed,panel.callBack(e,!0))},hide:function(e){var a=panel.opt.editor;a.stop(),a.data("top",a.position().top),a.animate({top:panel.opt.minHeight},panel.opt.speed,panel.callBack(e,!1))},callBack:function(e,a){$panel.data("isShow",a),a?($showBtn.find(".fa_btn").removeClass("fa-eye-slash"),$showBtn.find(".fa_btn").addClass("fa-eye")):($showBtn.find(".fa_btn").removeClass("fa-eye"),$showBtn.find(".fa_btn").addClass("fa-eye-slash"))},modeCtrl:function(e,t,n){$(e).bind("click",function(e){var a=$(this).parents(".set_module").find(".m_body");a.is(":hidden")?($(this).removeClass(t),$(this).addClass(n),a.slideDown()):($(this).removeClass(n),$(this).addClass(t),a.slideUp())})},keyEvent:function(e){$(document).bind({keyup:function(e){if(46==e.keyCode){var a=panel.parmArea.find(".pbox.pbox-selected");if(0<a.length&&a.data("puuid")){var t=getParmNodeForNodeTId(a.data("puuid"));layer.confirm("确认删除参数  “"+t.name+"” 吗？",{btn:["确定","全部删除","取消"]},function(e){a.remove(),t.custom=0,editParmNodeForNode(t),$(".resizable").hide(),layer.alert("删除成功!")},function(e){a.remove(),removeForParms(t),$(".resizable").hide(),layer.alert("全部删除成功!")},function(e){layer.close(e)})}}},keydown:function(e){}})},parmSetting:function(e,a,t){if(panel.isHover(e,panel.parmArea)){var n=a[0];if(panel.isexist(n.puuid))layer.msg("已经存在");else{var i=panel.innerPos(e,panel.parmArea);(n=panel.parmDefaultVaule(n)).position={y:i.top,x:i.left},editParmNodeForNode(n);var l=panel.getPboxTarget(n);panel.parmArea.append(l),panel.pbox(l)}}else layer.msg("不在查询区")},getPboxTarget:function(e,a){a?a.html(""):a=$('<div class="pbox"></div>'),a.data("puuid",e.puuid);var t=$('<span class="s_label">'+e.parmCName+"</span>"),n=$('<span class="s_input form-input"></span>');a.css({width:e.width+"px","line-height":e.height+"px",height:e.height+"px",top:e.position.y+"px",left:e.position.x+"px"});var i={width:e.widthL+"%","font-size":e.fontSize+"px"},l={width:e.widthR+"%","font-size":e.fontSize+"px"};"input"==e.showType?n.append('<input type="text" name="'+e.parmName+'"/>'):"select"==e.showType?n.append('<select name="'+e.parmName+'"><option>下拉选择</option></select>'):"multiple"==e.showType?n.append('<input type="text" name="'+e.parmName+'"/>'):"date"==e.showType?n.append('<input type="text" name="'+e.parmName+'"/>'):["year","month","time","datetime","render"].includes(e.showType)?n.append('<input type="text" name="'+e.parmName+'"/>'):"radio"==e.showType?n.append('<span>单选</span><input type="radio" name="'+e.parmName+'" style="width:'+e.fontSize+'px;height:100%;"/>'):"checkbox"==e.showType&&n.append('<span>复选</span><input type="checkbox" name="'+e.parmName+'" style="width:'+e.fontSize+'px;height:100%;"/>');var p=function(e,a){0==a?e["text-align"]="left":1==a?e["text-align"]="center":2==a&&(e["text-align"]="right")};return p(i,e.labelAlign),p(l,e.fieldAlign),0==e.verticalAlign?(i["vertical-align"]="top",l["vertical-align"]="top"):1==e.verticalAlign?(i["vertical-align"]="middle",l["vertical-align"]="middle"):2==e.verticalAlign&&(i["vertical-align"]="bottom",l["vertical-align"]="bottom"),t.css(i),n.css(l),1==e.selRange?a.append(t):(2==e.selRange||a.append(t),a.append(n)),a.bind("click",function(){panel.toolbarDataInit(this,e)}),a},isexist:function(a){var t=!1;return $(".pbox").each(function(){var e=$(this).data("puuid");a==e&&(t=!0)}),t},removeBox:function(){},pbox:function(a){$(a).bind({click:function(e){$(this).siblings(".pbox-selected").removeClass("pbox-selected"),$(this).addClass("pbox-selected"),panel.resizable($(this),panel.parmArea),panel.stopEvent(e)},mousedown:function(e){panel.relativePos(e,$(a))},mouseup:function(e){}})},mousemove:function(){$(document).bind({mousemove:function(e){},mouseup:function(){panel.opt.keydown=!1,document.onmousemove=null},mousedown:function(){panel.opt.keydown=!0}})},toolbar:function(){panel.setData(panel.parmbar,"lock",!0),panel.parmbar.find(".btn_lock").bind("click",function(e){panel.parmbar.data("lock")?(panel.parmbar.find(".btn_lock").removeClass(panel.opt.fa_unlock),panel.parmbar.find(".btn_lock").addClass(panel.opt.fa_lock),panel.setData(panel.parmbar,"lock",!1)):(panel.parmbar.find(".btn_lock").removeClass(panel.opt.fa_lock),panel.parmbar.find(".btn_lock").addClass(panel.opt.fa_unlock),panel.setData(panel.parmbar,"lock",!0))}),panel.parmbar.find(".set_title").bind({mousedown:function(e){panel.parmbar.addClass("p_move");var a=e.pageX-panel.parmbar.offset().left,t=e.pageY-panel.parmbar.offset().top;panel.setData(panel.parmbar,"left",a),panel.setData(panel.parmbar,"top",t),document.onmousemove=function(){var e=window.event;if(panel.parmbar.data("lock")){var a=e.pageX-panel.getData(panel.parmbar,"left"),t=e.pageY-panel.getData(panel.parmbar,"top");panel.parmbar.css({top:t+"px",left:a+"px"})}}}})},toolbarDataInit:function(t,p){if(void 0===panel.opt.left){var e=panel.position();panel.opt.top=e.top,panel.opt.left=e.left-panel.parmbar.width()-1,panel.parmbar.css({top:panel.opt.top+"px",left:panel.opt.left})}panel.parmbar.show(),panel.parmbar.data("target",t),p=getParmNodeForNodeTId($(t).data("puuid"));var o=["click","dbclick","focus","blur","select","change"],r=["labelAlign","selRange","fieldAlign","verticalAlign"];panel.parmbar.find("[data-type='p_data']").each(function(e,a){var t=$(this).attr("name"),n=p[t];if("positionX"==t||"positionY"==t){var i=p.position.x,l=p.position.y;panel.parmbar.find("[name='positionX']").val(i),panel.parmbar.find("[name='positionY']").val(l)}else r.includes(t)?panel.selectCustomMenu(this,n):"mustInput"==t||"readonly"==t||o.includes(t)&&(n="",p.parmEvent&&p.parmEvent[t]&&(n=p.parmEvent[t])),$(this).val(n)}),panel.parmbar.find("[data-type='p_data']").unbind(),panel.parmbar.find("[data-type='p_data']").bind("change",function(){var e=$(this).attr("name"),a=$(this).val();p=getParmNodeForNodeTId(p.puuid),p=$.extend(!0,p,panel.getParmValue()),panel.getPboxTarget(p,$(t)),"widthL"==e?panel.parmbar.find("[name='widthR']").val(100-a):"widthR"==e&&panel.parmbar.find("[name='widthL']").val(100-a),editParmNodeForNode(p)})},parmDefaultVaule:function(e){var a=function(e,a,t){void 0===node[a]&&(node[a]=t)};return a(0,"dbType","string"),a(0,"parmCName","参数"),a(0,"parmName","param"),a(0,"parmType","normal"),a(0,"parmvl",""),a(0,"showType","input"),a(0,"isnull",!1),a(0,"format",""),a(0,"selRange","0"),a(0,"parmEvent",{click:"",dbclick:"",focus:"",blur:"",select:"",change:""}),a(0,"position",{x:0,y:0}),a(0,"mustInput","0"),a(0,"readonly","0"),a(0,"labelAlign","1"),a(0,"fieldAlign","1"),a(0,"labelStyle",""),a(0,"fieldStyle",""),a(0,"width","80"),a(0,"widthL","50"),a(0,"widthR","50"),a(0,"height","35"),a(0,"fontSize","12"),a(0,"fieldSize",""),a(0,"verticalAlign","1"),a(0,"maxLength",0),e.custom=1,e},getParmValue:function(){var e=function(e){return panel.parmbar.find("[name='"+e+"']").val()},a=panel.parmbar.data("target"),t=$(a).position().left,n=$(a).position().top;return{dbType:e("dbType"),parmCName:e("parmCName"),parmName:e("parmName"),parmType:e("parmType"),parmvl:e("parmvl"),showType:e("showType"),isnull:!1,format:e("format"),selRange:e("selRange"),parmEvent:{click:e("click"),dbclick:e("dbclick"),focus:e("focus"),blur:e("blur"),select:e("select"),change:e("change")},position:{x:t,y:n},mustInput:e("mustInput"),readonly:e("readonly"),labelAlign:e("labelAlign"),fieldAlign:e("fieldAlign"),labelStyle:e("labelStyle"),fieldStyle:e("fieldStyle"),width:e("width"),widthL:e("widthL"),widthR:e("widthR"),height:e("height"),fontSize:e("fontSize"),fieldSize:e("fieldSize"),verticalAlign:e("verticalAlign"),maxLength:e("maxLength")}},resizeArea:function(){$panel.find(".resize_line").bind({mousedown:function(e){$(this).addClass("isresize");var a=e.pageY,t=$panel.height(),n=panel.opt.editor.offset().top;document.onmousemove=function(){var e=window.event.pageY-a;60<t+e&&($panel.css({height:t+e}),panel.opt.editor.css({top:n+e}))}}}),panel.parmArea.bind({click:function(){$(this).find(".pbox-selected").removeClass("pbox-selected"),$(".resizable").hide().css({top:0,left:0,width:0,height:0}),panel.parmbar.hide()}})},updateTarget:function(e){var a=getParmNodeForNodeTId($(e).data("puuid"));a=$.extend(!0,a,panel.getParmValue()),panel.getPboxTarget(a,$(panel.parmbar.data("target"))),a.custom=1,editParmNodeForNode(a)},resizable:function(e,p){var o=$(e),r=$(".resizable");return panel.setObjPosForObj(r,o),r.bind({mousedown:function(e){panel.setObjPos(e,o),document.onmousemove=function(){var e=window.event,a=o.data("pos"),t=a.rleft+e.pageX-a.x,n=a.rtop+e.pageY-a.y,i=a.left+e.pageX-a.x,l=a.top+e.pageY-a.y;panel.resizableArea(o,p,n,t)&&(r.css({left:i,top:l}),o.css({left:t,top:n}),panel.parmbar.find("[name='positionX']").val(t),panel.parmbar.find("[name='positionY']").val(n),panel.updateTarget(panel.parmbar.data("target")))},panel.stopEvent(e)},mouseup:function(e){}}),r.find(".resizable-handle").bind({mousedown:function(e){panel.setObjPos(e,o),document.onmousemove=function(){var e=window.event,a=o.data("pos"),t=e.pageX-a.x,n=e.pageY-a.y,i=a.height+n,l=a.width+t;r.css({height:i,width:l}),o.css({height:i,width:l}),panel.parmbar.find("[name='width']").val(l),panel.parmbar.find("[name='height']").val(i),panel.updateTarget(panel.parmbar.data("target"))},panel.stopEvent(e)},mouseup:function(e){}}),r},resizableArea:function(e,a,t,n){$(e).width(),$(e).height(),$(a).width(),$(a).height();return!0},iconMenu:function(){$(".customMenu").find(".licon").bind("click",function(){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected"),$(this).parents(".customMenu").siblings("[data-type='p_data']").val($(this).data("value")),$(this).parents(".customMenu").siblings("[data-type='p_data']").change()})},selectCustomMenu:function(e,a){var t=$(e).siblings(".customMenu");t.find(".selected").removeClass("selected"),t.find("[data-value='"+a+"']").addClass("selected")},menuList:function(){var n=$panel.find(".menu_list");$.each(panel.model,function(e,a){if(0!=a.sts){var t=$('<li class="ico_'+e+'" data-type="'+e+'"><i class="ico"></i>'+a.text+"</li>");n.append(t)}}),n.find("li").bind("mousedown",function(e){var a=$(this).data("type"),n=panel.model[a],t=panel.innerPos(event,panel.parmArea);n.position={y:t.top,x:t.left};var i=panel.getPboxTarget(n);panel.parmArea.append(i),document.onmousemove=function(){var e=window.event,a=panel.innerPos(e,panel.parmArea);i.css({left:a.left,top:a.top})},document.onmouseup=function(e){if(panel.isHover(e,panel.parmArea)){var a=panel.innerPos(e,panel.parmArea);n.position={y:a.top,x:a.left},n=addParmNodeForVal(n);var t=panel.getPboxTarget(n[0]);panel.parmArea.append(t),panel.pbox(t)}i.remove(),document.onmouseup=null},panel.stopEvent(e)})},pboxInit:function(e){panel.opt.init||($.each(e,function(e,a){if(1==a.custom){var t=panel.getPboxTarget(a);panel.parmArea.append(t),panel.pbox(t)}}),panel.opt.init=!0)},editer:function(){$(".js_edit").bind("click",function(){layer.open({type:1,title:"编辑JS",area:["60%","60%"],content:'<div id="jsEditor" style="width:100%;height: calc( 100% - 40px);border-bottom: 2px solid #f0f0f0;"></div>',success:function(e,a){var t=$('<div style="width: 100%;text-align: center;"></div>'),n=$('<input class="editor_btn" type="button" value="保存">');t.append(n),$(e).find(".layui-layer-content").append(t);var i=ace.edit($(e).find("#jsEditor")[0]);i.session.setMode("ace/mode/javascript");var l=panel.opt.js;l&&i.setValue(l),n.bind("click",function(){panel.opt.js=i.getValue(),layer.close(a)})}})}),$(".css_edit").bind("click",function(){layer.open({type:1,title:"CSS编辑",area:["60%","60%"],content:'<div id="cssEditor" style="width:100%;height: calc( 100% - 40px);border-bottom: 2px solid #f0f0f0;"></div>',success:function(e,a){var t=$('<div style="width: 100%;text-align: center;"></div>'),n=$('<input class="editor_btn" type="button" value="保存">');t.append(n),$(e).find(".layui-layer-content").append(t);var i=ace.edit($(e).find("#cssEditor")[0]);i.session.setMode("ace/mode/css");var l=panel.opt.css;l&&i.setValue(l),n.bind("click",function(){panel.opt.css=i.getValue(),layer.close(a)})}})})},getPanelVal:function(){var e={};return e.css=panel.opt.css,e.js=panel.opt.js,e.height=$(".panel_area").height(),e},getEncodeVal:function(){var e={};return e.css=""==panel.opt.css?"":Base64Util.encode64(panel.opt.css),e.js=""==panel.opt.js?"":Base64Util.encode64(panel.opt.js),e.height=$(".panel_area").height(),e},decode:function(){panel.opt.css=""==panel.opt.css||void 0===panel.opt.css?"":Base64Util.decode64(panel.opt.css),panel.opt.js=""==panel.opt.js||void 0===panel.opt.js?"":Base64Util.decode64(panel.opt.js)},init:function(e){panel.opt=$.extend(!0,panel.opt,e),panel.decode(),$panel.data("isShow",!1),$panel.css("height",parseInt(panel.opt.height)+30),$showBtn.find(".fa_btn").bind("click",function(e){$panel.data("isShow")?panel.hide(e):panel.show(e)}),panel.parmbar.find(".btn_close").bind("click",function(e){panel.parmbar.hide()}),panel.toolbar(),panel.mousemove(),panel.resizeArea(),panel.modeCtrl($(".m_title .t_btn .fa"),"fa-plus","fa-minus"),panel.keyEvent(),panel.iconMenu(),panel.menuList(),panel.editer()}};